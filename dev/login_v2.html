<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>媒山友｜會員登入</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/fa5.14.0all.min.css">
    <link rel="stylesheet" href="./css/fa5.14.0v4.min.css">
    <script src="./js/jquery.min.js"></script>
    <script src="./js/fa5.14.0all.js"></script>
    <script src="./js/sweetalert.min.js"></script>
    <link rel="stylesheet" href="./css/login_v2.css">
    <link rel="stylesheet" href="./css/footer.css">
    <link rel="stylesheet" href="./css/header.css">
</head>

<body>


    <header>
        <div id="headerbox">
            <a href="./Frontstageindex.html" class="logo">
                <img class="logo" src="./images/logo/LOGO_white.png" alt="">
            </a> 

            <nav class="menuhover">
                <ul class="menuhover">
                    <li class="bg bg1"></li>
                    <li class="bg bg2"></li>
                    <li class="bg bg3"></li>
                </ul>
            </nav>

            <nav class="menu">
                <ul class="link_list llleft">
                    <li><a class="tour" href="./meet2-0.html"><p>揪團區</p></a></li>
                    <li><a class="forum" href="./forum.html"><p>討論區</p></a></li>
                    <li><a class="product" href="./product.html"><p>商品區</p></a></li>
                </ul>
                <ul class="link_list llright">
                    <li>
                        <a href="./Member_v2.html"><div id="mem_avatar_box"><img id="mem_avatar_img" src=""></div></a>
                    </li>
                    <li><a href="./Member_v2.html"><div id="mem_info_id"></div></a></li>
                    <li><button id="Logout_btn" class="btnB_L_grey"><p>登出</p><div class="bg"><br></div></button></li>
                    <li><a class="member" id="member_jumpTo"><div class="memicon"><div class="membg"></div></div></a></li>
                    <li><a class="cart" href="./shoppingcart.html"><div class="carticon"><span class="add_count_others"></span><div class="cartbg"></div></div></a></li>
                    
                </ul>
            </nav>
            <div id="imagebox">
                <img id="picTour" src="./images/header/tour.png" alt="">
                <img id="picForum" src="./images/header/forum.png" alt="">
                <img id="picProduct" src="./images/header/product.png" alt="">
            </div>

            <div id="greymask"></div>
            <div id="hamburgerBG">
                <div class="ab white"></div>
                <div class="ab yellow1"></div>
                <div class="ab yellow2"></div>
                <div class="ab yellow3"></div>
            </div>
            <button class="hamburger hamburger--collapse" type="button">
                <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                </span>
            </button>
        </div>
    </header>
    <main>
        <div class="container right-panel-active">
            <!-- Sign In -->
            <div class="container__form container--signin">
                <div class="mobile_logo">
                    <img src="images/logo/LOGO_black.png">
                </div>
                <form class="form" id="signInForm" method="post">
                    <h2 class="form__title">會員登入</h2>
                    <input type="text" name="mem_acc" id="mem_acc" minlength="8" maxlength="12" pattern="[A-Za-z0-9]*" placeholder="帳號" /><br>
                    <div id="admin_psw1">
                        <input type="password" name="mem_psw" id="mem_psw" minlength="8" maxlength="12" pattern="[A-Za-z0-9]*" placeholder="密碼" /><br>
                        <img src="./images/icons/icon_Invisible.svg" alt="" width=25 height=25 id="eye">
                        <input type="checkbox" id="pswCheck" width=25 height=25>
                    </div>
                    <a href="#" class="clickMe_app">沒有帳號?點我註冊</a>
                    <button type="button" class="btnB_L_blue submitBtn_log" id="btnLogin"><p>登入</p><div class="bg"></div></button>
                </form>
            </div>

            <!-- Sign Up -->
            <div class="container__form container--signup">
                <div class="mobile_logo">
                    <img src="images/logo/LOGO_black.png">
                </div>
                <form class="form" id="signUpForm" method="post">
                    <h2 class="form__title">註冊帳號</h2>
                    <div class="form__detail">
                        <label for="mem_id">暱稱</label><br>
                        <input type="text" name="mem_id" id="mem_id" placeholder="中文限5字以內,英文限12字以內" maxlength="12" required/><br>
                        <label for="mem_name">姓名</label><br>
                        <input type="text" name="mem_name" id="mem_name" placeholder="不可為空" required/><br>
                        <label for="mem_mail">電子信箱</label><br>
                        <input type="email" name="mem_mail" id="mem_mail" placeholder="不可為空" required/><br>
                        <label for="mem_acc">帳號</label><br>
                        <input type="text" name="mem_acc" id="mem_acc_app" placeholder="限8-12英數字" maxlength="12" required/><br>
                        <label for="mem_psw">密碼</label><span class="tip_length" style="color: red;">密碼長度錯誤</span><br>
                        <input type="password" maxlength="12" minlength="8" name="mem_psw" id="mem_psw_app" onblur="checkpas1();" placeholder="限8-12英數字" required/><br>
                        <label for="repassword">確認密碼</label><span class="tip" style="color: red;">輸入密碼不一致</span><br>
                        <input type="password" name="repassword" id="repassword" onChange="checkpas();" placeholder="確認密碼" required><br>
                    </div>
                    <a href="#" class="clickMe_log">已有帳號?點我登入</a>
                    <button type="button" class="btnB_L_blue submitBtn_app" id="btnSignUp"><p>註冊</p><div class="bg"></div></button>
                </form>
            </div>

            <!-- Overlay -->
            <div class="container__overlay">
                <div class="overlay">
                    <div class="overlay__panel overlay--left">
                        <button class="btn" id="signUp">Sign Up</button>
                    </div>
                    <div class="overlay__panel overlay--right">
                        <div class="top_info">
                            <h3>會員相關訊息</h3>
                            <p>本平台提供揪團、討論、商品販售等服務，協助您線上找尋適合同行的夥伴及獲取更多相關知識
                                。也可在本平台藉由開團、發文累積點數，並可使用點數至購商品區購買相關商品。
                                本平台亦具有嚮導、實名制認證、徽章成就等，提供您更豐富的網站瀏覽經驗。
                                功能就是要您毫無畏懼地嘗試各種登山路線，並在持續探索的路上成為您的
                                最佳後援！
                            </p>
                        </div>
                        <div class="bottom_info">
                            <h3>個人資料保護法聲明</h3>
                            <p>個人資料蒐集目的：本站個資收集僅供帳號系統使用</p>
                            <!-- <p>個人資料蒐集目的：志工解說服務申請、登山申請及登山安全、自然教育中心課程 等服務 (訂位、住宿登記與購票事項、其他地方政府事務 ) 蒐集之個 人資料分類：個人基本資料、登山急難聯絡方式等。 (辨識個人、個人描述、意外或其他事故及有關情形) 個人資料保管期間：會員帳號 申請日至會員帳號刪除日，個人申請資料得自行申請刪除</p> -->
                        </div>
                        <button class="btn" id="signIn">Sign In</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="footer">
        <div class="footer_logo_block">
            <a href="./FrontstageIndex.html">
                <img src="./images/logo/LOGO_white.png" alt="">
            </a>
            <div class="copyright">Copyright © 2020 Mountain Community.</div>
        </div>
        <div class="footer_info">
            <div class="sevrves_place-serves_tel">
                <div class="place">
                    <div class="f_color1">桃園市中壢區中大路300號</div>
                    <div class="f_color1">工程二館 資策會大樓</div>
                </div>
                <div class="tel">
                    <div class="f_color1">連絡電話</div>
                    <div class="f_color1">(03)425-7387</div>
                </div>
            </div>
            <div class="serves_time-serves_email">
                <div class="time">
                    <div class="f_color1">服務時間</div>
                    <div class="f_color1">週一至週五10:00~17:00</div>
                </div>
                <div class="email">
                    <div class="f_color1">服務信箱</div>
                    <div class="f_color1">tibame@gmail.com</div>
                </div>
            </div>
            <div class="epaper-footer_link">
                <div class="epaper">
                    <div class="etitle f_color1">輸入信箱訂閱電子報</div>
                    <div class="einput">
                        <input type="text" placeholder="Email address">
                        <div class="e_bt f_color1">SUBSCRIBE</e_bt>
                        </div>
                    </div>
                    <div class="link">
                        <div class="linkup">
                            <div><a href="https://www.cwb.gov.tw/V8/C/" target="_blank">中央氣象局</a></div>
                            <div><a href="https://npm.cpami.gov.tw/" target="_blank">登山證申請</a></div>
                            <div><a href="" target="_blank">網站快速導覽</a></div>
                        </div>
                        <div class="linkdown">
                            <div><a href="" target="_blank">服務條款及隱私權政策</a></div>
                            <div><a href="" target="_blank">會員使用條款</a></div>
                        </div>
                    </div>
                </div>
            </div>
    </footer>

    <script src="./js/jquery.min.js"></script>
    <script src="./js/login_v2.js"></script>
    <script>
        const signInBtn = document.getElementById("signIn");
        const signUpBtn = document.getElementById("signUp");
        const fistForm = document.getElementById("signInForm");
        const secondForm = document.getElementById("signUpForm");
        const container = document.querySelector(".container");

        signUpBtn.addEventListener("click", () => {
            container.classList.remove("right-panel-active");
        });

        signInBtn.addEventListener("click", () => {
            container.classList.add("right-panel-active");
        });

        fistForm.addEventListener("submit", (e) => e.preventDefault());
        secondForm.addEventListener("submit", (e) => e.preventDefault());
    </script>

    <script>
        // 手機板註冊會員切換
        $(document).ready(function() {

            // if($('#mem_info_id').html() !== ''){
            //     window.location.href = './Member_v2.html'
            // }

            $('.clickMe_app').click(function() {
                $('.container--signin').css('display', 'none');
                $('.container--signup').css('display', 'block');
            });
            $('.clickMe_log').click(function() {
                $('.container--signup').css('display', 'none');
                $('.container--signin').css('display', 'block');
            });

            $('#pswCheck').click(function() {
                $(this).is(':checked') ? $('#mem_psw').attr('type', 'text') : $('#mem_psw').attr('type', 'password');
                if ($("#eye").attr('src') === "./images/icons/icon_Invisible.svg") {
                    $("#eye").attr("src", "./images/icons/icon_visibility.svg");
                } else {
                    $("#eye").attr("src", "./images/icons/icon_Invisible.svg");
                }
            });



        // 強制登出
            // let xhr = new XMLHttpRequest();
            // if($('#mem_info_id').html() !== ''){
            // }
            // xhr.open("get","./login_v2_Logout.php",true);
            // xhr.send(null);
        });

        // 註冊判斷帳號/暱稱是否使用過
        function checkId() {

            var idCheck = $("#mem_id").val();
            if (idCheck.length == "" ) { //帳號
                swal("暱稱不可空白", "請填寫暱稱","error");
                // alert('暱稱不可空白');
                return;
            }
            
            var mail=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            var mailCheck = $("#mem_mail").val();
            if(mailCheck.match(mail)==null){ //信箱
                swal("email格式不正確", "請確認email","error");
                return;
            }  

            var accCheck = $("#mem_acc_app").val();
            if (accCheck.length > 12 ^ accCheck == "" ) { //帳號
                swal("帳號長度錯誤", "請確認帳號","error");
                return;
            }

            var pswCheck = $("#mem_psw_app").val();
            if (pswCheck.length < 8 ^ pswCheck.length > 12) { //密碼
                swal("密碼長度錯誤", "8~12字以內","error");
                return;
            }

            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        swal(xhr.responseText);
                        if (xhr.responseText == '帳號註冊成功'){
                            if(localStorage.getItem('web') == null){ //註冊成功
                                swal(xhr.responseText); //回傳php回應的值
                                $(".swal-button--confirm").click(function(){
                                    $("#signUpForm").submit();
                                    window.location.href = './Member_v2.html';
                                })
                            }else{
                                let redirection = localStorage.getItem('web');
                                $("#signUpForm").submit();
                                window.location.href = redirection;
                            }
                        }
                    } else {
                        // alert(xhr.status); 
                    }
                }
            }

            xhr.open("post", "./login_v2_Signup.php", true);
            xhr.setRequestHeader("content-type", "application/x-www-form-urlencoded");
            let data_info = `mem_acc=${$id("mem_acc_app").value}&mem_id=${$id("mem_id").value}&mem_name=${$id("mem_name").value}&mem_psw=${$id("mem_psw_app").value}&mem_mail=${$id("mem_mail").value}`;
            xhr.send(data_info);
        }


        window.addEventListener("load", function() {
            document.getElementById("btnSignUp").addEventListener("click", checkId, false);
        }, false);

        // 確認密碼
        $(".tip").hide();
        $(".tip_length").hide();

        function checkpas1() { //當第一個密碼框失去焦點時，觸發checkpas1事件
            var pas1 = document.getElementById("mem_psw_app").value;
            var pas2 = document.getElementById("repassword").value;

            if (pas1.length < 8 ^ pas1.length > 12) {
                $(".tip_length").show();
            } else {
                $(".tip_length").hide();
            }
        }

        function checkpas() { //當第一個密碼框失去焦點時，觸發checkpas2件
            var pas1 = document.getElementById("mem_psw_app").value;
            var pas2 = document.getElementById("repassword").value; //獲取兩個密碼框的值
            if (pas1 !== pas2) {
                $(".tip").show(); //當兩個密碼不相等時則顯示錯誤資訊
                // alert('密碼不一致')
                $('.submitBtn_app').attr('disabled', true)
                $('.submitBtn_app').css('cursor', 'not-allowed')
            } else {
                $(".tip").hide();
                // alert('密碼一致')
                $('.submitBtn_app').attr('disabled', false)
                $('.submitBtn_app').css('cursor', 'pointer')
            }
        }

        // 長度判斷
        $('#mem_id').on('input', function (e) {
            var $that =  $(this),
                limit = 12;                            //定義所需字節數
            $that.attr('maxlength',limit);
            setTimeout(function(){
                var value =  $that.val(),
                    reg = /[\u4e00-\u9fa5]/g,
                    notReg = /\w/g;                     
                var Cn = value.match(reg);
                var En = value.match(notReg);
                if(Cn){
                    limit = limit - (Cn.length*2);
                }
                if(En){

                    limit = limit - En.length;
                }
                if(limit<=0){
                    var finalLen = value.length+limit;
                    value = value.substring(0,finalLen);
                    $that.attr('maxlength',limit);
                    $that[0].value = value;
                }
            },0);

        });

    </script>
    <script src="./js/header.js"></script>
    <script src="./js/login_v2.js"></script>
</body>

</html>